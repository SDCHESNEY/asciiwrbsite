@using AsciiSite.Shared.Configuration
@inject IAsciiArtProvider AsciiArtProvider
@inject LocalizationState LocalizationState
@implements IDisposable

@if (_hero is null)
{
    <section class="hero" aria-live="polite">
        <p class="text-muted">Loading ASCII banner...</p>
    </section>
}
else
{
    <section class="hero" aria-label="ASCII hero">
        <pre>@HeroBlock</pre>
        <p class="tagline">@DisplayTagline</p>
        <a class="cta" href="@DisplayCallToActionUrl">@DisplayCallToActionText</a>
        <ul class="nav-links">
            @foreach (var link in _hero.Navigation)
            {
                <li><a href="@link.Url">@link.Text</a></li>
            }
        </ul>
    </section>
}

@code {
    private AsciiHeroContent? _hero;

    private string HeroBlock => _hero is null
        ? string.Empty
        : string.Join(Environment.NewLine, _hero.HeroLines);

    private string DisplayTagline => LocalizationState.CurrentHero.Tagline?.Length > 0
        ? LocalizationState.CurrentHero.Tagline
        : _hero?.Tagline ?? string.Empty;

    private string DisplayCallToActionText => LocalizationState.CurrentHero.CallToActionText?.Length > 0
        ? LocalizationState.CurrentHero.CallToActionText
        : _hero?.CallToActionText ?? string.Empty;

    private string DisplayCallToActionUrl => string.IsNullOrWhiteSpace(LocalizationState.CurrentHero.CallToActionUrl)
        ? _hero?.CallToActionUrl ?? "/"
        : LocalizationState.CurrentHero.CallToActionUrl!;

    protected override void OnInitialized()
    {
        _hero = AsciiArtProvider.GetHero();
        LocalizationState.EnsureInitialized();
        LocalizationState.Changed += HandleLocalizationChanged;
    }

    private void HandleLocalizationChanged() => InvokeAsync(StateHasChanged);

    public void Dispose()
    {
        LocalizationState.Changed -= HandleLocalizationChanged;
    }
}
